\documentclass{article}

\usepackage{afterpage}
\usepackage{fontspec}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{lscape}
\usepackage{paralist}
\usepackage{siunitx}
\usepackage{titling}
\usepackage{wasysym}

\newcommand*{\subtitle}[1]{\gdef\thesubtitle{#1}}

\title{CRAPS Kernel}
\subtitle{Test Plan}
\author{
       Maxime Arthaud
  \and Korantin Auguste
  \and Martin Carton
  \and Ã‰tienne Lebrun
}

% \testok{id}{title}{what does the test tests}
\newcommand{\testok}[3]{%
  \noindent
  \begin{center}
    \begin{tabular}{|p{0.1\textwidth}|p{0.75\textwidth}|p{0.02\textwidth}|}
      \hline
      #1 & #2 & $\checked$
    \\\hline
      \multicolumn{3}{|p{0.9\textwidth}|}{#3}
    \\\hline
    \end{tabular}
  \end{center}
}

\newcommand{\testnop}[3]{%
  \noindent
  \begin{center}
    \begin{tabular}{|p{0.1\textwidth}|p{0.75\textwidth}|p{0.02\textwidth}|}
      \hline
      #1 & #2 & --
    \\\hline
      \multicolumn{3}{|p{0.9\textwidth}|}{#3}
    \\\hline
    \end{tabular}
  \end{center}
}


% \testko{id}{title}{what does the test tests}{why does the test fails}
\newcommand{\testko}[4]{%
  \noindent
  \begin{center}
    \begin{tabular}{|p{0.1\textwidth}|p{0.75\textwidth}|p{0.02\textwidth}|}
      \hline
      #1 & #2 & $\times$
    \\\hline
      \multicolumn{3}{|p{0.9\textwidth}|}{#3}
    \\\hline
      \multicolumn{3}{|p{0.9\textwidth}|}{#4}
    \\\hline
    \end{tabular}
  \end{center}
}


\begin{document}
  \include{titlepage}
  \tableofcontents
  \newpage

  \section{Introduction and Objectives}
    This document presents the testing strategies we used to test the tools
    produced for the CRAPS Kernel project. Three main tools have to be tested:
    \begin{inparaenum}[\itshape a\upshape)]
      \item the processor,
      \item the compiler,
      \item the kernel itself.
    \end{inparaenum}

    The tests for these tools are independent. But the kernel depends on both
    the processor and the compiler.

  \section{Objectives}
    \subsection{Processor Tests}
      The goals of these tests is to prove that every processor instruction
      works as intended. We will only test the features we have added to the
      processor given by Jean-Christophe Buisson, since he has already tested
      this version.

      Stress tests for the RS-232 will be needed to check that no data is lost.

    \subsection{Compiler Tests}
      The goals of these tests is to prove the code generated by the compiler is
      correct. We will have to tests every \textit{C} structure the compiler
      supports.

    \subsection{Kernel Tests}
      The goals of these tests is to prove the kernel is correct.

  \section{Tests}
    \subsection{Processor tests}
      \testok{1.1.1}{The processor shall have access to at least 8 kB of RAM}{%
        We write and read at all positions on the available RAM. The 7-segment
        is used to know if there is an error (9999 is an error, 1111 is ok).
      }

      \testok{1.1.2}{The RAM shall be accessed in less than 10 cycles}{%
        This exigence can not be tested automatically. It has been validated by
        drawing the sequencer state machine and counting the steps for the
        memory access instructions.
      }

      \testok{1.1.3}{The processor shall handle several interrupts sources}{%
        A test per different interrupt has been created. Another test case
        tests the priority of different interrupts.

        They use the 7-segment as an output and they cannot be fully automated
        (some interrupts require the user to push buttons).
      }
      \testok{1.1.4}{The processor shall support 19 registers}{%
        The kernel successfully uses all registers.
      }


      \testok{2.1.1}{The processor shall be connected to a serial port}{%
        No specific test but other tests use it.
      }

      \testnop{2.1.2}{No data shall be lost }{%
        The shell task successfully communicates via the serial port.
        We have not had time to implement a proper stress test.
      }

    \subsection{Compiler}
      \testok{1.2.1 / 2.2.1}{The compiler input shall be a subset of C89}{%
        The kernel uses all the elements available in the specified subset
      }
      \testko{1.2.2}{The compiler shall generate valid CRAPS assembly}{%
        We have made a lot of tests. We try to test as many features as
        possible.
      }{%
        We cannot test all possible programs, so the test cannot be validated.
        The kernel is however functional, which shows that pretty big programs
        can be successfully generated.
      }

      \testok{2.2.2}{The assembly generated shall be more optimized}{%
        We have compared the code generated before and after optimization for a
        typical sample of code. We managed to generate up to 25\% less
        instructions.
      }

    \subsection{Kernel}
      \testok{1.3.1}{The OS shall have a scheduler}{%
           The scheduler has been tested with various tasks displaying different
        number on the 7-segment to show it schedules.

        The tasks use registers and memory to check if the scheduler saves
        them correctly at context switch.
        }

      \testok{1.3.1.a/b}{The scheduler shall switch at least 10 times per
        second and support 10 tasks}{%
        We can interact with the shell using a python script, and launch 10
        tasks. One of these put the value of the switches on the LEDs. We
        observe that the reaction time is consistently lower than 1 second.
      }

      \testok{1.3.2}{The OS shall provide a basic library}{%
        The OS provides and uses that library. Tests independent from the kernel
        exists.
      }

      \testok{2.3.1/2.3.2}{%
        The OS shall have a task communicating using the RS-232
        port
      }{%
        A script exists to test the serial port.
      }

      \testok{2.3.2}{%
        The OS shall have an API to read/write on the serial port.
      }{%
        A script exists to test the serial port.
      }

    \subsection{Other tools}
      \testok{2.4.1}{The monitor shall be available in Linux}{%
        We use Linux as our main working environment and are able to use the
        monitor without any problem.
      }

      \testok{2.4.2}{The monitor shall display all the RAM}{%
        The same test as \textit{1.1.1} can be used.
      }

      \testok{2.4.3}{%
        The CRAPS assembler tool shall be available without a FPGA
        connected to the computer
      }{%
        A new tool \textit{crapsc} does that and is the main tool we use.
      }

      \testok{2.4.4}{Adapt the tools to make them work on Linux}{%
        All tools but \textit{shdl2vhdl} have been ported on Linux
        (\textit{shdl2vhdl} use Windows-specific tools).
      }

\end{document}
